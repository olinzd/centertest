<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Расписание смен сотрудников</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg-color: #f5f5f5;
      --container-bg: white;
      --text-color: #333;
      --border-color: #ddd;
      --day-bg: white;
      --current-day-bg: #e8f4ff;
      --header-bg: #f8f9fa;
      --button-bg: #4CAF50;
      --button-text: white;
      --modal-bg: white;
      --timeline-bg: #f0f0f0;
      --toggle-bg: #2196F3;
      --arrow-color: #666;
      --info-box-bg: #f9f9f9;
      --highlight-color: #ffeb3b;
      --grid-color: rgba(0,0,0,0.1);
      --parallelogram-height: 12px;
      --parallelogram-width: 60px;
      --parallelogram-highlight-height: 16px;
      --parallelogram-highlight-width: 70px;
      --parallelogram-small-height: 8px;
      --parallelogram-small-width: 50px;
    }

    .dark-theme {
      --bg-color: #1a1a1a;
      --container-bg: #2d2d2d;
      --text-color: #e6e6e6;
      --border-color: #444;
      --day-bg: #3d3d3d;
      --current-day-bg: #2a486b;
      --header-bg: #3d3d3d;
      --button-bg: #388E3C;
      --button-text: white;
      --modal-bg: #3d3d3d;
      --timeline-bg: #4d4d4d;
      --toggle-bg: #1976D2;
      --arrow-color: #ccc;
      --info-box-bg: #3a3a3a;
      --highlight-color: #ffc107;
      --grid-color: rgba(255,255,255,0.1);
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: background-color 0.4s, color 0.4s;
      font-size: 16px;
    }

    /* НАВИГАЦИЯ */
    .navigation {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: var(--container-bg);
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      z-index: 1000;
    }
    
    .desktop-navigation {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background-color: var(--container-bg);
      justify-content: space-around;
      padding: 15px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 1000;
    }
    
    .nav-button {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: none;
      border: none;
      cursor: pointer;
      opacity: 0.6;
      transition: opacity 0.3s;
    }
    
    .nav-button.active {
      opacity: 1;
    }
    
    .nav-icon {
      width: 28px;
      height: 28px;
      margin-bottom: 5px;
    }
    
    .nav-text {
      font-size: 12px;
    }
    
    /* СТРАНИЦЫ */
    .page {
      display: none;
      padding: 20px;
      padding-bottom: 70px;
    }
    
    .page.active {
      display: block;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: var(--container-bg);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .welcome-section {
      margin-bottom: 20px;
      padding: 15px;
      background-color: var(--info-box-bg);
      border-radius: 8px;
      border-left: 4px solid var(--toggle-bg);
    }

    .welcome-text {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .schedule-text {
      font-size: 20px;
      font-weight: bold;
      color: var(--toggle-bg);
    }

    .theme-switch {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .theme-switch-text {
      margin-right: 10px;
      font-size: 16px;
    }

    .theme-switch-wrapper {
      display: flex;
      align-items: center;
    }

    .theme-switch-label {
      display: inline-block;
      height: 28px;
      position: relative;
      width: 60px;
    }

    .theme-switch-label input {
      display: none;
    }

    .slider {
      background-color: #ccc;
      bottom: 0;
      cursor: pointer;
      left: 0;
      position: absolute;
      right: 0;
      top: 0;
      transition: .4s;
      border-radius: 28px;
    }

    .slider:before {
      background-color: white;
      bottom: 4px;
      content: "";
      height: 20px;
      left: 4px;
      position: absolute;
      transition: .4s;
      width: 20px;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: var(--toggle-bg);
    }

    input:checked + .slider:before {
      transform: translateX(32px);
    }

    .info-boxes {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 25px 0;
    }

    .info-box {
      background-color: var(--info-box-bg);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .info-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
      color: var(--toggle-bg);
    }

    .info-content {
      font-size: 20px;
      font-weight: bold;
    }

    .info-subcontent {
      font-size: 18px;
      margin-top: 8px;
      color: #666;
    }

    .dark-theme .info-subcontent {
      color: #ccc;
    }

    .toggle-calendar {
      padding: 15px 30px;
      background-color: var(--toggle-bg);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 25px auto;
      font-size: 18px;
      font-weight: bold;
    }

    .week-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 0 15px;
    }

    .nav-arrow {
      background: none;
      border: none;
      font-size: 32px;
      cursor: pointer;
      color: var(--arrow-color);
      padding: 8px 20px;
    }

    .week-range {
      font-weight: bold;
      font-size: 22px;
      text-align: center;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 15px;
    }

    .calendar-header {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      font-weight: bold;
      margin-bottom: 15px;
      padding: 15px;
      background-color: var(--header-bg);
      border-radius: 8px;
      font-size: 18px;
    }

    .day {
      border: 2px solid var(--border-color);
      border-radius: 8px;
      padding: 20px;
      min-height: 180px;
      position: relative;
      cursor: pointer;
      background-color: var(--day-bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }

    .day.current {
      background-color: var(--current-day-bg);
      border-color: var(--toggle-bg);
    }

    .day-header {
      font-weight: bold;
      margin-bottom: 20px;
      text-align: center;
      font-size: 20px;
    }

    .employee-parallelograms {
      display: flex;
      flex-direction: column;
      gap: 6px;
      width: 100%;
      align-items: center;
    }

    .parallelogram {
      height: var(--parallelogram-height);
      width: var(--parallelogram-width);
      background-color: #FF6633;
      transform: skew(-15deg);
      transition: all 0.4s ease;
      opacity: 1 !important;
    }

    .parallelogram.highlighted {
      height: var(--parallelogram-highlight-height);
      width: var(--parallelogram-highlight-width);
      transform: skew(-15deg) scale(1.15);
      order: -1;
      z-index: 2;
    }

    .parallelogram.small {
      height: var(--parallelogram-small-height);
      width: var(--parallelogram-small-width);
      opacity: 0.7;
    }

    .parallelogram-columns {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      width: 100%;
    }

    .parallelogram-column {
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: center;
    }

    .month-calendar {
      display: none;
    }

    .month-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-top: 15px;
    }

    .month-day {
      border: 1px solid var(--border-color);
      border-radius: 6px;
      padding: 10px;
      min-height: 100px;
      background-color: var(--day-bg);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .month-day:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .month-day.current {
      background-color: var(--current-day-bg);
      border-color: var(--toggle-bg);
    }

    .month-day.other-month {
      opacity: 0.4;
      background-color: var(--bg-color);
    }

    .month-day-header {
      font-weight: bold;
      text-align: center;
      margin-bottom: 8px;
      font-size: 14px;
      padding: 4px;
      border-radius: 4px;
      background-color: var(--header-bg);
    }

    .month-day-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .month-parallelogram {
      height: 8px;
      width: 38px;
      background-color: #FF6633;
      transform: skew(-15deg);
      transition: all 0.3s ease;
      opacity: 1 !important;
    }

    .month-parallelogram.highlighted {
      height: 12px;
      width: 50px;
      transform: skew(-15deg) scale(1.2);
      order: -1;
      z-index: 2;
    }

    .month-parallelogram.small {
      height: 6px;
      width: 28px;
      opacity: 0.5;
    }

    .month-parallelogram-columns {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 5px;
      justify-content: center;
      width: 100%;
    }

    .month-parallelogram-column {
      display: flex;
      flex-direction: column;
      gap: 3px;
      align-items: center;
    }

    .month-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 0 15px;
    }

    .month-range {
      font-weight: bold;
      font-size: 22px;
      text-align: center;
    }

    .week-calendar {
      display: block;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      z-index: 1000;
      overflow: auto;
    }

    .modal-content {
      background-color: var(--modal-bg);
      margin: 5% auto;
      padding: 25px;
      border-radius: 8px;
      width: 90%;
      max-width: 1800px;
      position: relative;
      max-height: 80vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .close {
      position: absolute;
      top: 15px;
      right: 25px;
      font-size: 36px;
      font-weight: bold;
      cursor: pointer;
      color: var(--text-color);
    }

    .timeline-container {
      display: flex;
      margin-top: 25px;
      flex: 1;
      overflow: hidden;
    }

    .employee-names {
      width: 200px;
      flex-shrink: 0;
      padding-right: 15px;
      border-right: 2px solid var(--border-color);
      position: relative;
      top: 55px;
    }

    .employee-name {
      height: 40px;
      font-weight: bold;
      display: flex;
      align-items: center;
      margin-bottom: 4px;
      font-size: 22px;
      padding: 2px 5px;
      transform: translateY(-15px);
    }

    .employee-name.highlighted {
      font-size: 16px;
      font-weight: bold;
      color: var(--highlight-color);
      order: -1;
    }

    .timeline-scroll {
      flex: 1;
      overflow-x: auto;
    }

    .timeline {
      min-width: 2400px;
      position: relative;
    }

    .timeline-grid {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: grid;
      grid-template-columns: repeat(26, 1fr);
      pointer-events: none;
    }

    .grid-line {
      border-right: 1px solid var(--grid-color);
      position: relative;
    }

    .grid-line.major::after {
      content: '';
      position: absolute;
      right: 0;
      top: 0;
      height: 100%;
      width: 1px;
      background-color: var(--grid-color);
      opacity: 0.7;
    }

    .timeline-header {
      display: grid;
      grid-template-columns: repeat(26, 1fr);
      grid-template-rows: 30px;
      margin-bottom: 10px;
      padding-left: 0;
      height: 30px;
      position: relative;
      z-index: 3;
    }

    .timeline-hour {
      font-size: 12px;
      padding: 2px 0;
      text-align: left;
      padding-left: 2px;
      grid-row: 1;
      display: flex;
      align-items: center;
      justify-content: flex-start;
    }

    .timeline-hour.half-hour {
      color: #888;
      font-size: 11px;
      padding: 2px 0;
      text-align: left;
      padding-left: 2px;
      grid-row: 1;
      display: flex;
      align-items: center;
      justify-content: flex-start;
    }

    .timeline-rows {
      position: relative;
      z-index: 2;
    }

    .timeline-row {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      height: 40px;
    }

    .timeline-bar {
      height: 35px;
      background-color: transparent;
      position: relative;
      flex: 1;
      min-width: 2400px;
      display: grid;
      grid-template-columns: repeat(26, 1fr);
    }

    .shift-block {
      position: absolute;
      height: 100%;
      border-radius: 4px;
      opacity: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 12px;
      font-weight: bold;
      z-index: 5;
      border: none;
    }

    .shift-block.highlighted {
      border: 2px solid white;
      z-index: 10;
      box-shadow: 0 0 5px rgba(255,255,255,0.3);
    }

    .loading {
      text-align: center;
      padding: 30px;
      font-size: 20px;
    }

    .no-shifts {
      text-align: center;
      padding: 15px;
      color: #777;
      font-style: italic;
      font-size: 16px;
    }

    .mobile-employee-names {
      display: none;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
      padding: 15px;
      border-top: 2px solid var(--border-color);
    }

    .mobile-employee-name {
      padding: 8px 15px;
      border-radius: 20px;
      background-color: var(--timeline-bg);
      font-size: 14px;
      font-weight: bold;
    }

    .mobile-employee-name.highlighted {
      background-color: var(--highlight-color);
      color: #000;
    }

    /* ПРОФИЛЬ */
    .profile-container {
      max-width: 600px;
      margin: 0 auto;
    }
    
    .profile-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .profile-avatar {
      position: relative;
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background-color: #ddd;
      margin: 0 auto 20px;
      overflow: hidden;
    }
    
    .profile-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .avatar-edit {
      position: absolute;
      bottom: 5px;
      right: 5px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: var(--button-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    .avatar-edit-icon {
      width: 18px;
      height: 18px;
      filter: invert(1);
    }
    
    .profile-name {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .profile-coins {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    
    .coins-icon {
      width: 24px;
      height: 24px;
      margin-right: 8px;
    }
    
    .profile-shifts {
      background-color: var(--info-box-bg);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .shift-item {
      margin-bottom: 15px;
    }
    
    .shift-title {
      font-weight: bold;
      margin-bottom: 5px;
      color: var(--toggle-bg);
    }
    
    .shift-info {
      font-size: 18px;
    }
    
    .color-picker-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 15px;
      background-color: var(--info-box-bg);
      border: none;
      border-radius: 8px;
      margin-bottom: 20px;
      cursor: pointer;
      width: 100%;
      font-size: 16px;
    }
    
    .color-icon {
      width: 20px;
      height: 20px;
      margin-right: 10px;
    }
    
    .logout-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 15px;
      background-color: #f44336;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      font-size: 16px;
      margin-top: 30px;
    }
    
    .logout-icon {
      width: 20px;
      height: 20px;
      margin-right: 10px;
      filter: invert(1);
    }
    
    /* МОДАЛЬНОЕ ОКНО ВЫБОРА ЦВЕТА */
    .color-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      z-index: 2000;
    }
    
    .color-modal-content {
      background-color: var(--modal-bg);
      margin: 10% auto;
      padding: 25px;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
      position: relative;
    }
    
    .color-preview {
      width: 100%;
      height: 80px;
      margin: 15px 0;
      border-radius: 8px;
    }
    
    .color-controls {
      margin-bottom: 20px;
    }
    
    .color-slider {
      width: 100%;
      margin: 10px 0;
    }
    
    .color-modal-buttons {
      display: flex;
      justify-content: space-between;
    }
    
    /* ЗАДАЧИ */
    .tasks-container {
      max-width: 800px;
      margin: 0 auto;
    }
    
    .tasks-day {
      background-color: var(--info-box-bg);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 25px;
    }
    
    .tasks-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .tasks-title {
      font-size: 20px;
      font-weight: bold;
    }
    
    .add-task-btn {
      padding: 8px 15px;
      background-color: var(--button-bg);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    
    .task-item {
      background-color: var(--container-bg);
      border-radius: 6px;
      padding: 15px;
      margin-bottom: 10px;
      border-left: 4px solid #4CAF50;
    }
    
    .task-item.high {
      border-left-color: #f44336;
    }
    
    .task-item.medium {
      border-left-color: #FF9800;
    }
    
    .task-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
    }
    
    .task-name {
      font-weight: bold;
      font-size: 18px;
    }
    
    .task-priority {
      display: flex;
    }
    
    .priority-star {
      color: #FFD700;
      margin-left: 2px;
    }
    
    .task-description {
      margin-bottom: 15px;
      color: #666;
    }
    
    .task-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .task-reward {
      display: flex;
      align-items: center;
      font-weight: bold;
    }
    
    .task-coins-icon {
      width: 16px;
      height: 16px;
      margin-right: 5px;
    }
    
    .complete-task-btn {
      padding: 8px 15px;
      background-color: var(--button-bg);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    
    /* МОДАЛЬНОЕ ОКНО ДОБАВЛЕНИЯ ЗАДАЧИ */
    .task-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      z-index: 2000;
    }
    
    .task-modal-content {
      background-color: var(--modal-bg);
      margin: 5% auto;
      padding: 25px;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      position: relative;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }
    
    .form-input, .form-textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--border-color);
      border-radius: 6px;
      background-color: var(--container-bg);
      color: var(--text-color);
      font-size: 16px;
      box-sizing: border-box;
    }
    
    .form-textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    .priority-slider {
      width: 100%;
      margin: 10px 0;
    }
    
    .priority-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 5px;
    }
    
    .priority-label {
      font-size: 12px;
    }
    
    .task-modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }
    
    /* УВЕДОМЛЕНИЕ О НАГРАДЕ */
    .reward-notification {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: var(--container-bg);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      z-index: 3000;
      text-align: center;
      display: none;
    }
    
    .reward-amount {
      font-size: 24px;
      font-weight: bold;
      margin: 15px 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .reward-coins-icon {
      width: 24px;
      height: 24px;
      margin-right: 8px;
    }
    
    /* МАГАЗИН */
    .shop-container {
      background-color: var(--info-box-bg);
      border-radius: 8px;
      padding: 20px;
      margin-top: 30px;
    }
    
    .shop-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 15px;
    }
    
    .shop-items {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
    }
    
    .shop-item {
      background-color: var(--container-bg);
      border-radius: 8px;
      padding: 15px;
      text-align: center;
    }
    
    .shop-item-icon {
      width: 40px;
      height: 40px;
      margin: 0 auto 10px;
    }
    
    .shop-item-name {
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .shop-item-price {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
    
    .shop-coins-icon {
      width: 14px;
      height: 14px;
      margin-right: 4px;
    }
    
    /* АДАПТИВ ДЛЯ НАВИГАЦИИ И СТРАНИЦ */
    @media (min-width: 769px) {
      .navigation {
        display: none;
      }
      
      .desktop-navigation {
        display: flex;
      }
      
      .page {
        padding-top: 80px;
        padding-bottom: 20px;
      }
    }
    
    @media (max-width: 768px) {
      .profile-avatar {
        width: 100px;
        height: 100px;
      }
      
      .avatar-edit {
        width: 28px;
        height: 28px;
      }
      
      .avatar-edit-icon {
        width: 16px;
        height: 16px;
      }
      
      .profile-name {
        font-size: 22px;
      }
      
      .profile-coins {
        font-size: 18px;
      }
      
      .coins-icon {
        width: 22px;
        height: 22px;
      }
      
      .shift-info {
        font-size: 16px;
      }
      
      .tasks-title {
        font-size: 18px;
      }
      
      .task-name {
        font-size: 16px;
      }
    }

    /* Мобильная адаптация */
    @media (max-width: 768px) {
      body {
        padding: 10px;
        font-size: 18px;
      }
      
      .container {
        padding: 15px;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .header {
        flex-direction: column;
        align-items: flex-start;
        width: 100%;
      }
      
      .welcome-section {
        width: 100%;
        box-sizing: border-box;
      }
      
      .welcome-text {
        font-size: 28px;
      }
      
      .schedule-text {
        font-size: 24px;
      }
      
      .filter-section {
        flex-direction: column;
        align-items: flex-start;
        width: 100%;
        gap: 12px;
      }
      
      .filter-label {
        font-size: 20px;
        width: 100%;
      }
      
      .filter-input {
        width: 100%;
        font-size: 18px;
        padding: 15px;
        box-sizing: border-box;
      }
      
      .filter-button {
        width: 100%;
        padding: 15px;
        font-size: 18px;
        box-sizing: border-box;
      }
      
      .info-boxes {
        grid-template-columns: 1fr;
        gap: 15px;
        width: 100%;
      }
      
      .info-box {
        padding: 15px;
        width: 100%;
        box-sizing: border-box;
      }
      
      .info-title {
        font-size: 20px;
      }
      
      .info-content {
        font-size: 22px;
      }
      
      .info-subcontent {
        font-size: 20px;
      }
      
      .calendar {
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
        width: 100%;
      }
      
      .calendar-header {
        font-size: 16px;
        padding: 12px;
      }
      
      .day {
        min-height: 120px;
        padding: 12px;
        width: 100%;
        box-sizing: border-box;
      }
      
      .day-header {
        font-size: 18px;
        margin-bottom: 15px;
      }
      
      .parallelogram {
        height: 10px;
        width: 30px;
      }
      
      .parallelogram.highlighted {
        height: 14px;
        width: 40px;
      }
      
      .parallelogram.small {
        height: 8px;
        width: 25px;
      }
      
      .month-parallelogram {
        height: 6px;
        width: 28px;
      }
      
      .month-parallelogram.highlighted {
        height: 10px;
        width: 40px;
      }
      
      .month-parallelogram.small {
        height: 5px;
        width: 15px;
      }
      
      .toggle-calendar {
        width: 100%;
        justify-content: center;
        font-size: 20px;
        padding: 18px;
        box-sizing: border-box;
      }
      
      .modal-content {
        width: 100%;
        margin: 0;
        padding: 20px;
        height: 100vh;
        max-height: 100vh;
        border-radius: 0;
      }
      
      .close {
        font-size: 40px;
        top: 10px;
        right: 15px;
      }
      
      .timeline-container {
        flex-direction: column;
        margin-top: 15px;
      }
      
      .employee-names {
        display: none !important;
      }
      
      .mobile-employee-names {
        display: flex !important;
      }
      
      .timeline-scroll {
        width: 100%;
        overflow-x: auto;
      }
      
      .timeline-header {
        padding-left: 0;
        flex-wrap: nowrap;
        min-width: 1600px;
        grid-template-rows: 35px;
        height: 35px;
      }
      
      .timeline-rows {
        min-width: 1600px;
      }
      
      .timeline-row {
        flex-direction: column;
        height: auto;
        margin-bottom: 25px;
        align-items: flex-start;
      }
      
      .timeline-bar {
        min-width: 1600px;
        height: 45px;
      }
      
      .shift-block {
        font-size: 16px;
      }
      
      .timeline-hour {
        font-size: 16px;
        min-width: 50px;
      }
      
      .timeline-hour.half-hour {
        font-size: 15px;
        min-width: 50px;
      }
      
      .week-navigation {
        flex-direction: column;
        gap: 15px;
      }
      
      .nav-arrow {
        font-size: 36px;
        padding: 5px 15px;
      }
    }

    /* Для десктопа */
    @media (min-width: 769px) {
      .mobile-employee-names {
        display: none !important;
      }
      
      .employee-names {
        display: block !important;
      }
    }

    @media (max-width: 480px) {
      body {
        font-size: 20px;
      }
      
      .calendar-header {
        font-size: 14px;
        padding: 10px;
      }
      
      .day {
        min-height: 100px;
        padding: 10px;
      }
      
      .week-range {
        font-size: 20px;
      }
      
      .parallelogram {
        height: 8px;
        width: 25px;
      }
      
      .parallelogram.highlighted {
        height: 12px;
        width: 35px;
      }
      
      .parallelogram.small {
        height: 6px;
        width: 20px;
      }
    }

    /* Стили для редактирования времени */
    .edit-time-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      z-index: 2000;
    }
    
    .edit-time-content {
      background-color: var(--modal-bg);
      margin: 10% auto;
      padding: 25px;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
      position: relative;
    }
    
    .time-input-group {
      margin-bottom: 20px;
    }
    
    .time-input {
      padding: 12px;
      border: 2px solid var(--border-color);
      border-radius: 6px;
      width: 100px;
      font-size: 16px;
      margin: 0 10px;
    }
    
    .time-separator {
      font-size: 20px;
      font-weight: bold;
    }
    
    .edit-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    
    .shift-block.editable {
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .shift-block.editable:hover {
      transform: scale(1.05);
      box-shadow: 0 0 10px rgba(255,255,255,0.5);
    }
    
    .admin-badge {
      position: absolute;
      top: 5px;
      right: 5px;
      background-color: #ff4757;
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- Навигация для десктопа -->
  <div class="desktop-navigation">
    <button class="nav-button" data-page="tasks">
      <img src="https://img.icons8.com/?size=100&id=vYcR85LYBebW&format=png&color=000000" class="nav-icon" alt="Задачи">
      <span class="nav-text">Задачи</span>
    </button>
    <button class="nav-button active" data-page="schedule">
      <img src="https://img.icons8.com/?size=100&id=EPWi0qK2GM93&format=png&color=000000" class="nav-icon" alt="График">
      <span class="nav-text">График</span>
    </button>
    <button class="nav-button" data-page="profile">
      <img src="https://img.icons8.com/?size=100&id=ABBSjQJK83zf&format=png&color=000000" class="nav-icon" alt="Профиль">
      <span class="nav-text">Профиль</span>
    </button>
  </div>
  
  <!-- Страницы -->
  <div id="schedule-page" class="page active">
    <div class="container">
      <div class="header">
        <h1>Расписание смен сотрудников</h1>
        <div id="admin-badge" class="admin-badge" style="display: none;">ADMIN</div>
      </div>
      
      <div class="welcome-section">
        <div id="welcome-text" class="welcome-text">Здравствуйте!</div>
        <div class="schedule-text">График работы:</div>
      </div>

      <div class="theme-switch">
        <span class="theme-switch-text">Тёмная тема:</span>
        <div class="theme-switch-wrapper">
          <label class="theme-switch-label">
            <input type="checkbox" id="theme-switch" onchange="toggleTheme()">
            <span class="slider"></span>
          </label>
        </div>
      </div>
      
      <div id="week-calendar" class="week-calendar">
        <div class="week-navigation">
          <button class="nav-arrow" onclick="changeWeek(-1)">←</button>
          <div id="week-range" class="week-range"></div>
          <button class="nav-arrow" onclick="changeWeek(1)">→</button>
        </div>
        
        <div class="calendar-header">
          <div>Понедельник</div>
          <div>Вторник</div>
          <div>Среда</div>
          <div>Четверг</div>
          <div>Пятница</div>
          <div>Суббота</div>
          <div>Воскресенье</div>
        </div>
        <div id="week-days" class="calendar">
          <!-- Неделя будет заполнена через JavaScript -->
        </div>
      </div>
      
      <div id="month-calendar" class="month-calendar">
        <div class="month-navigation">
          <button class="nav-arrow" onclick="changeMonth(-1)">←</button>
          <div id="month-range" class="month-range"></div>
          <button class="nav-arrow" onclick="changeMonth(1)">→</button>
        </div>
        
        <div class="calendar-header">
          <div>Пн</div>
          <div>Вт</div>
          <div>Ср</div>
          <div>Чт</div>
          <div>Пт</div>
          <div>Сб</div>
          <div>Вс</div>
        </div>
        <div id="month-grid" class="month-grid">
          <!-- Месяц будет заполнен через JavaScript -->
        </div>
      </div>
      
      <button class="toggle-calendar" onclick="toggleCalendarView()">
        <span id="toggle-text">Развернуть на месяц</span>
        <span id="toggle-icon">▼</span>
      </button>
      
      <div class="info-boxes">
        <div class="info-box">
          <div class="info-title">Смена сегодня:</div>
          <div id="today-shift-info" class="info-content">Загрузка...</div>
        </div>
        <div class="info-box">
          <div class="info-title">Следующая смена:</div>
          <div id="next-shift-date" class="info-content">-</div>
          <div id="next-shift-time" class="info-subcontent">-</div>
        </div>
      </div>
      
      <div id="day-modal" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeModal()">&times;</span>
          <h2 id="modal-date"></h2>
          <div class="timeline-container">
            <div id="employee-names" class="employee-names">
              <!-- Имена сотрудников будут заполнены через JavaScript -->
            </div>
            <div class="timeline-scroll">
              <div id="modal-timeline" class="timeline">
                <!-- Таймлайн будет заполнен через JavaScript -->
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div id="loading" class="loading">Загрузка данных...</div>
    </div>
  </div>
  
  <div id="profile-page" class="page">
    <div class="container">
      <div class="profile-container">
        <div class="profile-header">
          <div class="profile-avatar">
            <img id="profile-avatar-img" src="" alt="Аватар">
          </div>
          <div id="profile-name" class="profile-name"></div>
          <div class="profile-coins">
            <img src="https://img.icons8.com/?size=100&id=undefined&format=png&color=000000" class="coins-icon" alt="Монеты">
            <span id="profile-coins-amount">Монеты: 0</span>
          </div>
        </div>
        
        <div class="profile-shifts">
          <div class="shift-item">
            <div class="shift-title">Сегодня смена:</div>
            <div id="profile-today-shift" class="shift-info">-</div>
          </div>
          <div class="shift-item">
            <div class="shift-title">Следующая смена:</div>
            <div id="profile-next-shift-date" class="shift-info">-</div>
            <div id="profile-next-shift-time" class="shift-info">-</div>
          </div>
        </div>
        
        <button class="color-picker-btn" onclick="openColorPicker()">
          <img src="https://img.icons8.com/?size=100&id=8184&format=png&color=000000" class="color-icon" alt="Цвет">
          Выбрать цвет в графике
        </button>
        
        <div class="theme-switch">
          <span class="theme-switch-text">Тёмная тема:</span>
          <div class="theme-switch-wrapper">
            <label class="theme-switch-label">
              <input type="checkbox" id="authorized-theme-switch" onchange="toggleTheme()">
              <span class="slider"></span>
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div id="tasks-page" class="page">
    <div class="container">
      <div class="tasks-container">
        <div id="tasks-content">
          <!-- Задачи будут загружаться здесь -->
        </div>
      </div>
    </div>
  </div>
  
  <!-- Навигация для мобильных -->
  <div class="navigation">
    <button class="nav-button" data-page="tasks">
      <img src="https://img.icons8.com/?size=100&id=vYcR85LYBebW&format=png&color=000000" class="nav-icon" alt="Задачи">
      <span class="nav-text">Задачи</span>
    </button>
    <button class="nav-button active" data-page="schedule">
      <img src="https://img.icons8.com/?size=100&id=EPWi0qK2GM93&format=png&color=000000" class="nav-icon" alt="График">
      <span class="nav-text">График</span>
    </button>
    <button class="nav-button" data-page="profile">
      <img src="https://img.icons8.com/?size=100&id=ABBSjQJK83zf&format=png&color=000000" class="nav-icon" alt="Профиль">
      <span class="nav-text">Профиль</span>
    </button>
  </div>
  
  <!-- Модальные окна -->
  <div id="color-modal" class="color-modal">
    <div class="color-modal-content">
      <span class="close" onclick="closeColorModal()">&times;</span>
      <h2>Выбор цвета</h2>
      
      <div id="color-preview" class="color-preview"></div>
      
      <div class="color-controls">
        <label>Тон:</label>
        <input type="range" min="0" max="360" value="0" class="color-slider" id="hue-slider" oninput="updateColorPreview()">
        
        <label>Насыщенность:</label>
        <input type="range" min="0" max="100" value="100" class="color-slider" id="saturation-slider" oninput="updateColorPreview()">
        
        <label>Яркость:</label>
        <input type="range" min="0" max="100" value="50" class="color-slider" id="brightness-slider" oninput="updateColorPreview()">
      </div>
      
      <div class="color-modal-buttons">
        <button class="filter-button exit" onclick="closeColorModal()">Отмена</button>
        <button class="filter-button" onclick="saveColor()">Применить</button>
      </div>
    </div>
  </div>
  
  <!-- Уведомление о награде -->
  <div id="reward-notification" class="reward-notification">
    <h3>Задача выполнена!</h3>
    <div class="reward-amount">
      <img src="https://img.icons8.com/?size=100&id=undefined&format=png&color=000000" class="reward-coins-icon" alt="Монеты">
      <span id="reward-coins">+10</span> монет
    </div>
    <p>Награда добавлена на ваш счет</p>
  </div>

  <script>
    // Глобальные переменные
    const tg = window.Telegram.WebApp;
    const APP_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz9d8Ga5wlPozchrrDn47Uuuh206xcmi_nRagAK_kz5WqCabUICCBZQ45Pshr_761Jr/exec';
    
    let shiftsData = [];
    let employeesData = [];
    let employeeColors = {};
    let currentEmployeeIds = [];
    let currentEmployeeName = "";
    let isMonthView = false;
    let currentWeekStart = new Date();
    let currentMonthStart = new Date();
    let isDarkTheme = false;
    let currentEmployeeData = null;
    let isAdmin = false;
    let currentTasks = [];
    
    // Функция инициализации при загрузке страницы
    function initialize() {
      // Устанавливаем начало текущей недели (понедельник)
      const today = new Date();
      const dayOfWeek = today.getDay();
      currentWeekStart = new Date(today);
      currentWeekStart.setDate(today.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));
      
      // Устанавливаем начало текущего месяца
      currentMonthStart = new Date(today.getFullYear(), today.getMonth(), 1);
      
      // Проверяем сохраненную тему
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.body.classList.add('dark-theme');
        document.getElementById('theme-switch').checked = true;
        document.getElementById('authorized-theme-switch').checked = true;
        isDarkTheme = true;
      }
      
      // Настраиваем навигацию
      setupNavigation();
      
      // Инициализируем Telegram WebApp
      if (tg) {
        tg.expand();
        tg.ready();
        tg.enableClosingConfirmation();
        
        // Авторизация через Telegram
        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
          const user = tg.initDataUnsafe.user;
          currentEmployeeName = `${user.first_name}${user.last_name ? ' ' + user.last_name : ''}`;
          document.getElementById('welcome-text').textContent = `Здравствуйте, ${currentEmployeeName}!`;
          document.getElementById('profile-name').textContent = currentEmployeeName;
          
          // Загружаем данные
          loadData(user.id);
        } else {
          // Fallback для тестирования вне Telegram
          document.getElementById('welcome-text').textContent = "Здравствуйте!";
          loadTestData();
        }
      } else {
        // Fallback для тестирования вне Telegram
        document.getElementById('welcome-text').textContent = "Здравствуйте!";
        loadTestData();
      }
    }
    
    // Загрузка тестовых данных (для разработки)
    function loadTestData() {
      // Тестовые данные для разработки
      currentEmployeeIds = [1, 2];
      loadAllData();
    }
    
    // Настройка навигации между страницами
    function setupNavigation() {
      const navButtons = document.querySelectorAll('.nav-button');
      const pages = document.querySelectorAll('.page');
      
      navButtons.forEach(button => {
        button.addEventListener('click', function() {
          const targetPage = this.getAttribute('data-page');
          
          // Деактивируем все кнопки и страницы
          navButtons.forEach(btn => btn.classList.remove('active'));
          pages.forEach(page => page.classList.remove('active'));
          
          // Активируем текущую кнопку и страницу
          this.classList.add('active');
          document.getElementById(`${targetPage}-page`).classList.add('active');
        });
      });
    }
    
    // Переключение темы
    function toggleTheme() {
      isDarkTheme = !isDarkTheme;
      
      if (isDarkTheme) {
        document.body.classList.add('dark-theme');
        localStorage.setItem('theme', 'dark');
      } else {
        document.body.classList.remove('dark-theme');
        localStorage.setItem('theme', 'light');
      }
      
      // Обновляем все переключатели темы
      document.getElementById('theme-switch').checked = isDarkTheme;
      document.getElementById('authorized-theme-switch').checked = isDarkTheme;
    }
    
    // Загрузка данных
    async function loadData(telegramId) {
      try {
        // Получаем ID сотрудников по Telegram ID
        const idsResponse = await fetch(`${APP_SCRIPT_URL}?function=getEmployeeIds&telegramId=${telegramId}`);
        
        if (!idsResponse.ok) {
          throw new Error(`Ошибка сервера: ${idsResponse.status}`);
        }
        
        currentEmployeeIds = await idsResponse.json();
        console.log('Найдены ID сотрудников:', currentEmployeeIds);
        
        if (currentEmployeeIds.length === 0) {
          alert('Сотрудник не найден. Обратитесь к администратору.');
          document.getElementById('loading').style.display = 'none';
          return;
        }
        
        // Загружаем все данные
        loadAllData();
        
      } catch (error) {
        console.error('Ошибка загрузки:', error);
        alert('Ошибка загрузки данных: ' + error.message);
        document.getElementById('loading').style.display = 'none';
      }
    }
    
    // Загрузка всех данных
    async function loadAllData() {
      try {
        // Загружаем смены для всех ID
        const allShifts = [];
        for (const id of currentEmployeeIds) {
          try {
            const shiftsResponse = await fetch(`${APP_SCRIPT_URL}?function=getShiftsByEmployeeId&employeeId=${id}`);
            
            if (shiftsResponse.ok) {
              const shifts = await shiftsResponse.json();
              console.log(`Смены для ID ${id}:`, shifts);
              
              // Добавляем employeeId к каждой смене
              const shiftsWithId = shifts.map(shift => ({
                ...shift,
                employeeId: id,
                isMainUser: true // Помечаем как смены текущего пользователя
              }));
              
              allShifts.push(...shiftsWithId);
            }
          } catch (error) {
            console.warn(`Ошибка загрузки смен для ID ${id}:`, error);
          }
        }
        
        shiftsData = allShifts;
        console.log('Всего смен загружено:', shiftsData.length);
        
        // Генерируем цвета для каждого сотрудника
        generateEmployeeColors();
        
        // Обновляем информацию о сменах
        updateShiftInfo();
        
        // Обновляем профиль
        updateProfileView();
        
        // Строим календари
        updateWeekDisplay();
        if (isMonthView) {
          updateMonthDisplay();
        }
        
        // Скрываем индикатор загрузки
        document.getElementById('loading').style.display = 'none';
        
      } catch (error) {
        console.error('Ошибка загрузки данных:', error);
        alert('Ошибка загрузки данных: ' + error.message);
        document.getElementById('loading').style.display = 'none';
      }
    }
    
    // Генерация цветов для сотрудников
    function generateEmployeeColors() {
      const colors = [
        '#FF6633', '#FFB399', '#FF33FF', '#FFFF99', '#00B3E6',
        '#E6B333', '#3366E6', '#999966', '#99FF99', '#B34D4D',
        '#80B300', '#809900', '#E6B3B3', '#6680B3', '#66991A',
        '#FF99E6', '#CCFF1A', '#FF1A66', '#E6331A', '#33FFCC',
        '#66994D', '#B366CC', '#4D8000', '#B33300', '#CC80CC',
        '#66664D', '#991AFF', '#E666FF', '#4DB3FF', '#1AB399'
      ];
      
      // Используем сохраненные цвета или генерируем новые
      currentEmployeeIds.forEach((employeeId, index) => {
        const savedColor = localStorage.getItem(`employeeColor_${employeeId}`);
        employeeColors[employeeId] = savedColor || colors[index % colors.length];
      });
    }
    
    // Обновление информации о сменах
    function updateShiftInfo() {
      const today = new Date();
      const todayString = formatDate(today);
      
      // Находим смены сотрудника
      const employeeShifts = shiftsData.filter(shift => 
        currentEmployeeIds.includes(parseInt(shift.employeeId)) && shift.date >= todayString
      ).sort((a, b) => a.date.localeCompare(b.date));
      
      // Проверяем, есть ли смена сегодня
      const todayShift = employeeShifts.find(shift => shift.date === todayString);
      
      if (todayShift) {
        document.getElementById('today-shift-info').textContent = "Сегодня у Вас смена";
        document.getElementById('today-shift-info').style.color = "#4CAF50";
        document.getElementById('profile-today-shift').textContent = "Да";
        document.getElementById('profile-today-shift').style.color = "#4CAF50";
      } else {
        document.getElementById('today-shift-info').textContent = "Сегодня у Вас нет смены";
        document.getElementById('today-shift-info').style.color = "#f44336";
        document.getElementById('profile-today-shift').textContent = "Нет";
        document.getElementById('profile-today-shift').style.color = "#f44336";
      }
      
      // Находим следующую смену
      const nextShift = employeeShifts.find(shift => shift.date > todayString);
      
      if (nextShift) {
        const nextDate = new Date(nextShift.date);
        const options = { day: 'numeric', month: 'long', year: 'numeric' };
        const dateString = nextDate.toLocaleDateString('ru-RU', options);
        
        document.getElementById('next-shift-date').textContent = dateString;
        document.getElementById('next-shift-time').textContent = `${nextShift.hours} часов`;
        
        document.getElementById('profile-next-shift-date').textContent = dateString;
        document.getElementById('profile-next-shift-time').textContent = `${nextShift.hours} часов`;
      } else {
        document.getElementById('next-shift-date').textContent = "Нет запланированных смен";
        document.getElementById('next-shift-time').textContent = "";
        
        document.getElementById('profile-next-shift-date').textContent = "Нет запланированных смен";
        document.getElementById('profile-next-shift-time').textContent = "";
      }
    }
    
    // Обновление отображения профиля
    function updateProfileView() {
      // Устанавливаем монеты (можно добавить функционал позже)
      document.getElementById('profile-coins-amount').textContent = `Монеты: 0`;
    }
    
    // Открытие модального окна выбора цвета
    function openColorPicker() {
      // Устанавливаем текущий цвет сотрудника, если есть
      if (currentEmployeeIds.length > 0) {
        const currentColor = employeeColors[currentEmployeeIds[0]];
        if (currentColor && currentColor.startsWith('hsl')) {
          const matches = currentColor.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);
          if (matches) {
            document.getElementById('hue-slider').value = matches[1];
            document.getElementById('saturation-slider').value = matches[2];
            document.getElementById('brightness-slider').value = matches[3];
          }
        }
      }
      
      updateColorPreview();
      document.getElementById('color-modal').style.display = 'block';
    }
    
    // Закрытие модального окна выбора цвета
    function closeColorModal() {
      document.getElementById('color-modal').style.display = 'none';
    }
    
    // Обновление предпросмотра цвета
    function updateColorPreview() {
      const hue = document.getElementById('hue-slider').value;
      const saturation = document.getElementById('saturation-slider').value;
      const brightness = document.getElementById('brightness-slider').value;
      
      const color = `hsl(${hue}, ${saturation}%, ${brightness}%)`;
      document.getElementById('color-preview').style.backgroundColor = color;
    }
    
    // Сохранение выбранного цвета
    function saveColor() {
      const hue = document.getElementById('hue-slider').value;
      const saturation = document.getElementById('saturation-slider').value;
      const brightness = document.getElementById('brightness-slider').value;
      
      const color = `hsl(${hue}, ${saturation}%, ${brightness}%)`;
      
      // Сохраняем цвет для всех ID сотрудников
      currentEmployeeIds.forEach(employeeId => {
        employeeColors[employeeId] = color;
        localStorage.setItem(`employeeColor_${employeeId}`, color);
      });
      
      // Перерисовываем календари
      if (isMonthView) {
        renderMonthCalendar();
      } else {
        renderWeekCalendar();
      }
      
      closeColorModal();
    }
    
    // Переключение между видами календаря
    function toggleCalendarView() {
      isMonthView = !isMonthView;
      
      if (isMonthView) {
        document.getElementById('week-calendar').style.display = 'none';
        document.getElementById('month-calendar').style.display = 'block';
        document.getElementById('toggle-text').textContent = 'Свернуть к неделе';
        document.getElementById('toggle-icon').textContent = '▲';
        updateMonthDisplay();
      } else {
        document.getElementById('week-calendar').style.display = 'block';
        document.getElementById('month-calendar').style.display = 'none';
        document.getElementById('toggle-text').textContent = 'Развернуть на месяц';
        document.getElementById('toggle-icon').textContent = '▼';
        updateWeekDisplay();
      }
    }
    
    // Переключение недели
    function changeWeek(direction) {
      currentWeekStart.setDate(currentWeekStart.getDate() + (direction * 7));
      updateWeekDisplay();
    }
    
    // Переключение между месяцами
    function changeMonth(direction) {
      currentMonthStart.setMonth(currentMonthStart.getMonth() + direction);
      renderMonthCalendar();
    }
    
    // Обновление отображения недели
    function updateWeekDisplay() {
      renderWeekCalendar();
      updateWeekRangeText();
    }
    
    // Обновление отображения месяца
    function updateMonthDisplay() {
      renderMonthCalendar();
      updateMonthRangeText();
    }
    
    // Обновление текста диапазона недели
    function updateWeekRangeText() {
      const weekEnd = new Date(currentWeekStart);
      weekEnd.setDate(currentWeekStart.getDate() + 6);
      
      const options = { day: 'numeric', month: 'long' };
      const startText = currentWeekStart.toLocaleDateString('ru-RU', options);
      const endText = weekEnd.toLocaleDateString('ru-RU', options);
      
      document.getElementById('week-range').textContent = `${startText} - ${endText}`;
    }
    
    // Обновление текста диапазона месяца
    function updateMonthRangeText() {
      const monthNames = ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь",
                         "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"];
      const year = currentMonthStart.getFullYear();
      document.getElementById('month-range').textContent = `${monthNames[currentMonthStart.getMonth()]} ${year}`;
    }
    
    // Отображение календаря недели
    function renderWeekCalendar() {
      const weekDaysContainer = document.getElementById('week-days');
      weekDaysContainer.innerHTML = '';
      
      for (let i = 0; i < 7; i++) {
        const dayDate = new Date(currentWeekStart);
        dayDate.setDate(currentWeekStart.getDate() + i);
        
        const dayElement = createDayElement(dayDate, true);
        weekDaysContainer.appendChild(dayElement);
      }
    }
    
    // Отображение календаря месяца
    function renderMonthCalendar() {
      const monthGrid = document.getElementById('month-grid');
      monthGrid.innerHTML = '';
      
      const today = new Date();
      const currentMonth = currentMonthStart.getMonth();
      const currentYear = currentMonthStart.getFullYear();
      
      // Первый день месяца
      const firstDay = new Date(currentYear, currentMonth, 1);
      // Последний день месяца
      const lastDay = new Date(currentYear, currentMonth + 1, 0);
      
      // День недели первого дня месяца
      let firstDayOfWeek = firstDay.getDay();
      firstDayOfWeek = firstDayOfWeek === 0 ? 6 : firstDayOfWeek - 1;
      
      // Добавляем пустые ячейки для дней предыдущего месяца
      const prevMonthLastDay = new Date(currentYear, currentMonth, 0).getDate();
      for (let i = 0; i < firstDayOfWeek; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'month-day other-month';
        const dayNumber = prevMonthLastDay - firstDayOfWeek + i + 1;
        emptyDay.innerHTML = `
          <div class="month-day-header">${dayNumber}</div>
          <div class="month-day-content"></div>
        `;
        monthGrid.appendChild(emptyDay);
      }
      
      // Добавляем дни текущего месяца
      for (let i = 1; i <= lastDay.getDate(); i++) {
        const dayDate = new Date(currentYear, currentMonth, i);
        const dayElement = createMonthDayElement(dayDate);
        monthGrid.appendChild(dayElement);
      }
      
      // Добавляем пустые ячейки для дней следующего месяца
      const totalCells = 42;
      const remainingCells = totalCells - (firstDayOfWeek + lastDay.getDate());
      for (let i = 1; i <= remainingCells; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'month-day other-month';
        emptyDay.innerHTML = `
          <div class="month-day-header">${i}</div>
          <div class="month-day-content"></div>
        `;
        monthGrid.appendChild(emptyDay);
      }
      
      updateMonthRangeText();
    }
    
    // Создание элемента дня для недельного календаря
    function createDayElement(date, isWeekView) {
      const dayElement = document.createElement('div');
      dayElement.className = 'day';
      
      // Проверяем, является ли день текущим
      const today = new Date();
      if (date.toDateString() === today.toDateString()) {
        dayElement.classList.add('current');
      }
      
      // Форматируем дату для отображения
      const dayNumber = date.getDate();
      
      const dayHeader = document.createElement('div');
      dayHeader.className = 'day-header';
      dayHeader.textContent = dayNumber;
      
      dayElement.appendChild(dayHeader);
      
      // Форматируем дату для сравнения
      const dateString = formatDate(date);
      
      // Находим смены на этот день
      const dayShifts = shiftsData.filter(shift => shift.date === dateString);
      
      if (dayShifts.length > 0) {
        // Создаем контейнер для параллелограммов
        const parallelogramContainer = document.createElement('div');
        parallelogramContainer.className = 'employee-parallelograms';
        
        // Сортируем смены: сначала текущий сотрудник
        const sortedShifts = [...dayShifts];
        sortedShifts.sort((a, b) => {
          if (currentEmployeeIds.includes(parseInt(a.employeeId)) && !currentEmployeeIds.includes(parseInt(b.employeeId))) return -1;
          if (!currentEmployeeIds.includes(parseInt(a.employeeId)) && currentEmployeeIds.includes(parseInt(b.employeeId))) return 1;
          return 0;
        });
        
        // Группируем смены по сотрудникам
        const employeesWithShifts = {};
        const shiftsCount = sortedShifts.length;
        
        // Определяем количество столбцов в зависимости от количества смен
        let columns = 1;
        if (shiftsCount > 5) columns = 2;
        if (shiftsCount > 10) columns = 3;
        
        if (columns > 1) {
          // Создаем контейнер с колонками
          const columnsContainer = document.createElement('div');
          columnsContainer.className = isWeekView ? 'parallelogram-columns' : 'month-parallelogram-columns';
          
          // Создаем колонки
          for (let i = 0; i < columns; i++) {
            const column = document.createElement('div');
            column.className = isWeekView ? 'parallelogram-column' : 'month-parallelogram-column';
            columnsContainer.appendChild(column);
          }
          
          // Распределяем смены по колонкам
          sortedShifts.forEach((shift, index) => {
            if (!employeesWithShifts[shift.employeeId]) {
              employeesWithShifts[shift.employeeId] = true;
              
              const columnIndex = index % columns;
              const column = columnsContainer.children[columnIndex];
              
              const parallelogram = document.createElement('div');
              parallelogram.className = isWeekView ? 'parallelogram' : 'month-parallelogram';
              
              // Применяем стили в зависимости от фильтра
              if (currentEmployeeIds.includes(parseInt(shift.employeeId))) {
                parallelogram.classList.add('highlighted');
              } else if (shiftsCount > 10) {
                parallelogram.classList.add('small');
              }
              
              parallelogram.style.backgroundColor = employeeColors[shift.employeeId];
              parallelogram.title = `Сотрудник ${shift.employeeId}: ${shift.hours}ч`;
              
              column.appendChild(parallelogram);
            }
          });
          
          parallelogramContainer.appendChild(columnsContainer);
        } else {
          // Для малого количества смен - просто в один столбец
          sortedShifts.forEach(shift => {
            if (!employeesWithShifts[shift.employeeId]) {
              employeesWithShifts[shift.employeeId] = true;
              
              const parallelogram = document.createElement('div');
              parallelogram.className = isWeekView ? 'parallelogram' : 'month-parallelogram';
              
              // Применяем стили в зависимости от фильтра
              if (currentEmployeeIds.includes(parseInt(shift.employeeId))) {
                parallelogram.classList.add('highlighted');
              }
              
              parallelogram.style.backgroundColor = employeeColors[shift.employeeId];
              parallelogram.title = `Сотрудник ${shift.employeeId}: ${shift.hours}ч`;
              
              parallelogramContainer.appendChild(parallelogram);
            }
          });
        }
        
        dayElement.appendChild(parallelogramContainer);
      } else {
        const noShifts = document.createElement('div');
        noShifts.className = 'no-shifts';
        noShifts.textContent = 'Нет смен';
        dayElement.appendChild(noShifts);
      }
      
      // Добавляем обработчик клика для открытия модального окна
      dayElement.addEventListener('click', () => {
        openDayModal(date);
      });
      
      return dayElement;
    }
    
    // Создание элемента дня для месячного календаря
    function createMonthDayElement(date) {
      const dayElement = document.createElement('div');
      dayElement.className = 'month-day';
      
      // Проверяем, является ли день текущим
      const today = new Date();
      if (date.toDateString() === today.toDateString()) {
        dayElement.classList.add('current');
      }
      
      // Форматируем дату для отображения
      const dayNumber = date.getDate();
      
      const dayHeader = document.createElement('div');
      dayHeader.className = 'month-day-header';
      dayHeader.textContent = dayNumber;
      
      const dayContent = document.createElement('div');
      dayContent.className = 'month-day-content';
      
      // Форматируем дату для сравнения
      const dateString = formatDate(date);
      
      // Находим смены на этот день
      const dayShifts = shiftsData.filter(shift => shift.date === dateString);
      
      if (dayShifts.length > 0) {
        // Создаем контейнер для параллелограммов
        const parallelogramContainer = document.createElement('div');
        parallelogramContainer.className = 'month-parallelogram-columns';
        
        // Сортируем смены: сначала текущий сотрудник
        const sortedShifts = [...dayShifts];
        sortedShifts.sort((a, b) => {
          if (currentEmployeeIds.includes(parseInt(a.employeeId)) && !currentEmployeeIds.includes(parseInt(b.employeeId))) return -1;
          if (!currentEmployeeIds.includes(parseInt(a.employeeId)) && currentEmployeeIds.includes(parseInt(b.employeeId))) return 1;
          return 0;
        });
        
        // Группируем смены по сотрудникам
        const employeesWithShifts = {};
        const shiftsCount = sortedShifts.length;
        
        // Определяем количество столбцов в зависимости от количества смен
        let columns = 1;
        if (shiftsCount > 5) columns = 2;
        if (shiftsCount > 10) columns = 3;
        
        // Создаем колонки
        for (let i = 0; i < columns; i++) {
          const column = document.createElement('div');
          column.className = 'month-parallelogram-column';
          parallelogramContainer.appendChild(column);
        }
        
        // Распределяем смены по колонкам
        sortedShifts.forEach((shift, index) => {
          if (!employeesWithShifts[shift.employeeId]) {
            employeesWithShifts[shift.employeeId] = true;
            
            const columnIndex = index % columns;
            const column = parallelogramContainer.children[columnIndex];
            
            const parallelogram = document.createElement('div');
            parallelogram.className = 'month-parallelogram';
            
            // Применяем стили в зависимости от фильтра
            if (currentEmployeeIds.includes(parseInt(shift.employeeId))) {
              parallelogram.classList.add('highlighted');
            } else if (shiftsCount > 10) {
              parallelogram.classList.add('small');
            }
            
            parallelogram.style.backgroundColor = employeeColors[shift.employeeId];
            parallelogram.title = `Сотрудник ${shift.employeeId}: ${shift.hours}ч`;
            
            column.appendChild(parallelogram);
          }
        });
        
        dayContent.appendChild(parallelogramContainer);
      }
      
      dayElement.appendChild(dayHeader);
      dayElement.appendChild(dayContent);
      
      // Добавляем обработчик клика для открытия модального окна
      dayElement.addEventListener('click', () => {
        openDayModal(date);
      });
      
      return dayElement;
    }
    
    // Открытие модального окна с деталями дня
    function openDayModal(date) {
      const modal = document.getElementById('day-modal');
      const modalDate = document.getElementById('modal-date');
      const employeeNamesContainer = document.getElementById('employee-names');
      const modalTimeline = document.getElementById('modal-timeline');
      
      // Форматируем дату для отображения
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      modalDate.textContent = date.toLocaleDateString('ru-RU', options);
      
      // Очищаем содержимое модального окна
      employeeNamesContainer.innerHTML = '';
      modalTimeline.innerHTML = '';
      
      // Создаем контейнер для мобильных имен
      const mobileEmployeeNamesContainer = document.createElement('div');
      mobileEmployeeNamesContainer.className = 'mobile-employee-names';
      
      // Форматируем дату для сравнения
      const dateString = formatDate(date);
      
      // Находим все смены на этот день
      const dayShifts = shiftsData.filter(shift => shift.date === dateString);
      
      if (dayShifts.length === 0) {
        modalTimeline.innerHTML = '<p>В этот день нет смен</p>';
      } else {
        // Определяем временной диапазон для дня
        const startHour = 8;
        const endHour = 22;
        const totalHours = endHour - startHour;
        
        // Создаем сетку для таймлайна
        const timelineGrid = document.createElement('div');
        timelineGrid.className = 'timeline-grid';
        
        for (let i = 0; i <= totalHours; i++) {
          const gridLine = document.createElement('div');
          gridLine.className = 'grid-line major';
          timelineGrid.appendChild(gridLine);
        }
        
        modalTimeline.appendChild(timelineGrid);
        
        // Создаем заголовок таймлайна с часами
        const timelineHeader = document.createElement('div');
        timelineHeader.className = 'timeline-header';
        
        for (let hour = startHour; hour <= endHour; hour++) {
          const hourElement = document.createElement('div');
          hourElement.className = 'timeline-hour';
          hourElement.textContent = `${hour}:00`;
          timelineHeader.appendChild(hourElement);
        }
        
        modalTimeline.appendChild(timelineHeader);
        
        // Группируем смены по сотрудникам
        const shiftsByEmployee = {};
        dayShifts.forEach(shift => {
          if (!shiftsByEmployee[shift.employeeId]) {
            shiftsByEmployee[shift.employeeId] = [];
          }
          shiftsByEmployee[shift.employeeId].push(shift);
        });
        
        // Сортируем сотрудников: сначала текущий сотрудник
        const sortedEmployeeIds = Object.keys(shiftsByEmployee);
        sortedEmployeeIds.sort((a, b) => {
          if (currentEmployeeIds.includes(parseInt(a)) && !currentEmployeeIds.includes(parseInt(b))) return -1;
          if (!currentEmployeeIds.includes(parseInt(a)) && currentEmployeeIds.includes(parseInt(b))) return 1;
          return 0;
        });
        
        // Создаем блоки с именами сотрудников для десктопа
        sortedEmployeeIds.forEach(employeeId => {
          const nameElement = document.createElement('div');
          nameElement.className = 'employee-name';
          
          // Подсвечиваем текущего сотрудника
          if (currentEmployeeIds.includes(parseInt(employeeId))) {
            nameElement.classList.add('highlighted');
          }
          
          nameElement.textContent = `Сотрудник ${employeeId}`;
          nameElement.style.color = employeeColors[employeeId];
          employeeNamesContainer.appendChild(nameElement);
          
          // Создаем такие же элементы для мобильной версии
          const mobileNameElement = document.createElement('div');
          mobileNameElement.className = 'mobile-employee-name';
          
          if (currentEmployeeIds.includes(parseInt(employeeId))) {
            mobileNameElement.classList.add('highlighted');
          }
          
          mobileNameElement.textContent = `Сотрудник ${employeeId}`;
          mobileNameElement.style.color = employeeColors[employeeId];
          mobileNameElement.style.backgroundColor = employeeColors[employeeId] + '40';
          mobileEmployeeNamesContainer.appendChild(mobileNameElement);
        });
        
        // Добавляем мобильные имена в конец таймлайна
        const timelineScroll = modalTimeline.parentElement;
        timelineScroll.appendChild(mobileEmployeeNamesContainer);
        
        // Создаем контейнер для строк таймлайна
        const timelineRows = document.createElement('div');
        timelineRows.className = 'timeline-rows';
        
        // Создаем строки таймлайна для каждого сотрудника
        sortedEmployeeIds.forEach((employeeId, index) => {
          const timelineRow = document.createElement('div');
          timelineRow.className = 'timeline-row';
          
          const timelineBar = document.createElement('div');
          timelineBar.className = 'timeline-bar';
          
          shiftsByEmployee[employeeId].forEach(shift => {
            // Предполагаем, что смена длится указанное количество часов
            const hours = shift.hours || 8;
            const startPosition = ((10 - startHour) / totalHours) * 100; // Начинаем с 10 утра
            const width = (hours / totalHours) * 100;
            
            const shiftBlock = document.createElement('div');
            shiftBlock.className = 'shift-block';
            
            // Подсвечиваем смену текущего сотрудника
            if (currentEmployeeIds.includes(parseInt(shift.employeeId))) {
              shiftBlock.classList.add('highlighted');
            }
            
            shiftBlock.style.left = `${startPosition}%`;
            shiftBlock.style.width = `${width}%`;
            shiftBlock.style.backgroundColor = employeeColors[shift.employeeId];
            
            shiftBlock.textContent = `${shift.hours}ч`;
            shiftBlock.title = `Сотрудник ${shift.employeeId}: ${shift.hours} часов`;
            
            timelineBar.appendChild(shiftBlock);
          });
          
          timelineRow.appendChild(timelineBar);
          timelineRows.appendChild(timelineRow);
        });
        
        modalTimeline.appendChild(timelineRows);
      }
      
      // Показываем модальное окно
      modal.style.display = 'block';
    }
    
    // Закрытие модального окна
    function closeModal() {
      const modal = document.getElementById('day-modal');
      const mobileNames = modal.querySelector('.mobile-employee-names');
      if (mobileNames) {
        mobileNames.remove();
      }
      modal.style.display = 'none';
    }
    
    // Закрытие модального окна при клике вне его
    window.onclick = function(event) {
      const modal = document.getElementById('day-modal');
      if (event.target === modal) {
        closeModal();
      }
    };
    
    // Вспомогательные функции
    function formatDate(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }
    
    // Инициализация при загрузке страницы
    window.onload = initialize;
  </script>
</body>
</html>
